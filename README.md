# ASYNCH - Particle Tracking

A tool for simulating particles flow and tracking on outputs from [IFC's Asynch](https://github.com/Iowa-Flood-Center/asynch) - based hydrological models.

## Description and Requirements

The tools consists basically on a set of Bash and Python 3.3 scripts.
Additional Python libraries required for a proper execution include:

- numpy (library for improved numerical processing);
- h5py (library for managing HD5 files);
- mathplotlib (for plotting graphs).


## Basic Usage

The basic workflow for this tool consists in:

1. Executing an hydrological model using IFC's Asynch framework (version 1.3.2);
2. Performing the particle tracking simulation;
3. Plot the result of the particle tracking simulation.

### Executing IFC's Asynch

TODO

 and `bash_trackParticles.sh` in sequence.

### Tracking Particles

The simulation of particles flows in the network is performed by the script `bash_trackParticles.sh` (or `job_trackParticles.job`, if using clusters).

It requires:

- the `.rvr` (topology) file used as input on the Asynch model run;
- the `.prm` (domain parameters) file used as input on the Asynch model run;
- the set of `.h5` output files generated by the model run.

The user must specify:

- a link id in the model domain to be taken as the outlet of the evaluated watershed;
- how distribute particles in the domain (explained bellow).

And generates as output a binary file describing the timeseries of particles flow in the outlet link of the system.

This script is expected to be executed in terminal and may receives either a set of arguments on its call or a single json file argument.

#### Set of arguments

`TODO`

#### Single json file argument

One can execute the script using only one argument instead as:

    bash bash_trackParticles.sh <CONFIG_FILE.json>

in which <CONFIG_FILE.json> must be replaced by the path of a JSON file with the following configuration:

	{"asynch_parttrack_conf":{
            "particles":{
                "initial_distribution":{
                    "method":<"all_equal"|"volume_proportional"|"none">,
                    "number_particles":<number-of-particles|"none">,
					"volume_per_parts":<volume-per-particle|"none">
                },
                "rainfall_distribution":{
                    "method":<"volume_proportional"|"none">,
                    "volume_per_parts":<volume-per-particle|"none">
                }
            },
            "watershed":{
                "outlet_link_id":<link-id>,
                "rvr_file_path":"<path-for-rvr-file>",
                "prm_file_path":"<path-for-prm-file>"
            },
            "simulation":{
                "hdf5_file_path":"<path-for-h5-file>",
                "particle_track_file_path":"<path-for-partrack-file>"
            },
            "plotting":{
                "y_axis_limit":<y-limit>,
                "graph_title":"<title-of-graph>",
                "png_file_path":"<path-for-png-file>"
            },
			"description":"<free-text-describing-experiment>"
        }
    }

An example, as provided in `examples/case02`:

    {"asynch_parttrack_conf":{
            "particles":{
                "initial_distribution":{
                    "method":"all_equal",
                    "number_particles":4
                },
                "rainfall_distribution":{
                    "method":"volume_proportional",
                    "volume_per_parts":144000
                }
            },
            "watershed":{
                "outlet_link_id":522792,
                "rvr_file_path":"~/asynch_particleTracking/example/case02/asynch_inputs/case02.rvr",
                "prm_file_path":"~/asynch_particleTracking/example/case02/asynch_inputs/case02.prm"
            },
            "simulation":{
                "hdf5_file_path":"~/asynch_particleTracking/example/case02/asynch_outputs/case02_1483228800.h5",
                "particle_track_file_path":"~/asynch_particleTracking/example/case02/asynch_particles/case02.p"
            },
            "plotting":{
                "y_axis_limit":65,
                "graph_title":"Cedar River at Osage, Iowa - USA",
                "png_file_path":"~/asynch_particleTracking/example/case02/asynch_particles/case02.png"
            },
			"description":"Example simulation for the upper Cedar River, near Osage (Iowa - US)."
        }
    }

### Plotting hydrograph

## Documentation

ASYNCH - Particle Tracking project still does not have further documentation in place.
